@page "/persons/detail/{Id:int}"
@using System.ComponentModel.DataAnnotations
@using TEKO.Testing.Web.ContributorEndpoints
@using TEKO.Testing.Web.Persons
@inject IHttpClientFactory Http


<MudTextField Label="Имя" Variant="Variant.Outlined"
              @bind-Value="model.Name" For="@(() => model.Name)"/>
<MudTextField Label="Фамилия" Variant="Variant.Outlined"
              @bind-Value="model.Surname" For="@(() => model.Surname)"/>
<MudTextField Label="Отчество" Variant="Variant.Outlined"
              @bind-Value="model.Patronymic" For="@(() => model.Patronymic)"/>
<MudSelect T="double" Label="Price" Variant="Variant.Outlined" AnchorOrigin="Origin.BottomCenter">
    <MudSelectItem T="double" Value="4.50" />
    <MudSelectItem T="double" Value="4.99" />
    <MudSelectItem T="double" Value="3.60" />
</MudSelect>
<MudCardActions>
    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Save</MudButton>
</MudCardActions>


@code {

    [Parameter]
    public int Id { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();
        HttpClient client = Http.CreateClient();
        List<PersonRecord>? resultPersons = client
            .GetFromJsonAsync<PersonListResponse>("http://localhost:57679/persons")
            .Result?.Persons;
        PersonRecord? person = resultPersons?.FirstOrDefault(p => p.Id == Id);
        if (person != null)
            model = new RegisterPersonForm
            {
                Id = person.Id,
                Name = person.Name,
                Surname = person.Surname,
                Patronymic = person.Patronymic
            };
    }


    RegisterPersonForm model = new RegisterPersonForm();
    //bool success;

    public class RegisterPersonForm
    {
        [Required]
        public int  Id { get; set; }
        
        [Required]
        public string? Name { get; set; }

        [Required]
        public string? Surname { get; set; }

        [Required]
        public string? Patronymic { get; set; }
        [Required]
        public int  AppointmentId { get; set; }
        [Required]
        public int  Age { get; set; }
        [Required]
        public int  Gender { get; set; }
    }

    private void OnValidSubmit(EditContext context)
    {
        //success = true;
        StateHasChanged();
    }    

}
